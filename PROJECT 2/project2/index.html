<head>
    <script src="https://d3js.org/d3.v5.min.js"></script>
  </head>
  <!--
  Group Members: Yishu Zhang (yz923), Aasim Ayaz Wani (aw579)
  citation: Yishu's own HW4 (about how to handle time, add text label and mouse event for each shape (histogram here) generated by each data point)
   if statement for color picking: https://stackoverflow.com/questions/49993165/d3-how-to-change-colour-of-text-based-on-value-if-else
   https://stackoverflow.com/questions/10805184/show-data-on-mouseover-of-circle
   what to do if tooltip not show up: https://stackoverflow.com/questions/41623548/why-is-my-tooltip-not-showing-up
   how to do tooltip in general: https://medium.com/@kj_schmidt/show-data-on-mouse-over-with-d3-js-3bf598ff8fc2
   https://www.d3-graph-gallery.com/graph/histogram_tooltip.html 
   Learn from stack overflow about how to import multiple data files in the same graph
   https://stackoverflow.com/questions/21842384/importing-data-from-multiple-csv-files-in-d3
   Learn from Yishu's own HW5 about how to do line generator
   Learn from d3-shape library about different line generators:
   https://github.com/d3/d3-shape#lines
   Learn about how to draw dashed line: http://www.d3noob.org/2013/01/making-dashed-line-in-d3js.html
   learn from Observable how to use d3.bisect: https://observablehq.com/@d3/d3-bisect
   Learn from Feb 26th lecture note about how to handle mouse event over line with an unvisible area
   https://jeffrz.github.io/info3300-spr2020/notes/20.02.26.notes.htm
   Learn about how to draw a basic line in d3:
   https://webdva.github.io/how-to-draw-a-line-in-d3js/
   https://jeffrz.github.io/info3300-spr2020/notes/20.04.13.notes.htm (adjust color)
   https://www.w3schools.com/html/html_formatting.asp (bolded text)
  //-->
  <html><body>
    <b> Representative Stock Price versus SP 500 (average market) Stock Price (dotted line are important dates)<br/></b>
    <p id="p1"> 
      Positive news: March 26 and April 21: stimulus packge; April 16 and April 29: Gilead brought good news about Remdesivir<br/>
      Negative news: March 23:Markets realized that COVID-19 reached US; April 20: Oil price drops below 0 dollar <br />
        </p>
        <svg id="firstplot" width="1320" height="300"> 
            <text  id="amazonlabel" x=500 y=30>
                
             </text>

             <text  id="zoomlabel" x=1100 y=30>
                
             </text>

           

             <text  id="positivelabel1" x=425 y=15>
                
             </text>

             <text  id="positivelabel2" x=1002 y=15>
                
             </text>
        </svg>
        <script>
Promise.all([d3.csv("AMZN.csv"),d3.csv("^GSPC.csv"),d3.csv("ZM.csv")]).then(function(files) {

          AmazonData =files[0] 
          SPData = files[1] 
          ZMData = files[2]

          d3.select("#amazonlabel").text("AMAZON");
          d3.select("#zoomlabel").text("ZOOM");
          d3.select("#positivelabel1").text("POSITIVE GROWTH");
          d3.select("#positivelabel2").text("POSITIVE GROWTH");
         
          let timeparser=d3.timeParse('%Y-%m-%d');

              AmazonData.forEach(d=>{
                   d['Volume'] = Number(d['Volume']);
                   d['Close'] = Number (d['Close'])
                    d["Date"] = timeparser(d["Date"]);
               });

               SPData.forEach((d,i)=>{
                   d['Volume'] = Number(d['Volume']);
                   d['Close'] = Number (d['Close'])
                  d["Date"] = timeparser(d["Date"])
               });

               ZMData.forEach((d,i)=>{
                   d['Volume'] = Number(d['Volume']);
                   d['Close'] = Number (d['Close'])
                  d["Date"] = timeparser(d["Date"])
               });

             let svg = d3.select("svg#firstplot");
             let width = svg.attr("width");
             let height = svg.attr("height");

            

             let xExtent = d3.extent(AmazonData, d => d["Date"]);
           let xScale = d3.scaleTime().domain(xExtent).range([50,550]);
           let secondxScale= d3.scaleTime().domain(xExtent).range([650,1150]);

          const AmazonMinClose=d3.min(AmazonData, (d) => {return d['Close'];} ); 
          const AmazonMaxClose=d3.max(AmazonData, (d) => {return d['Close'];} );

             const SPMinClose = d3.min(SPData, (d) => {return d['Close'];});
             const SPMaxClose = d3.max(SPData, (d) => {return d['Close'];});

             const ZMMinClose=d3.min(ZMData, (d) => {return d['Close'];} );
             const ZMMaxClose=d3.max(ZMData, (d) => {return d['Close'];} );

            let AmazonCloseScale=d3.scaleLinear().domain([AmazonMinClose,AmazonMaxClose]) .range([height-100,(height-100)/2]);

            let ZMCloseScale=d3.scaleLinear().domain([ZMMinClose,ZMMaxClose]) .range([height-100,(height-100)/2]);

           let SPCloseScale = d3.scaleLinear().domain([SPMinClose,SPMaxClose]) .range([(height-100)/2,0]);


             let xAxis=d3.axisBottom(xScale);

             let secondxAxis = d3.axisBottom(secondxScale);


            svg.append("g").attr("class", "xAxis").attr("transform", "translate(0,200)")
            .call(xAxis.tickFormat(d3.timeFormat("%b %Y")).ticks(d3.timeMonth.every(1)));

            svg.append("g").attr("class", "second xAxis").attr("transform", "translate(0,200)")
            .call(secondxAxis.tickFormat(d3.timeFormat("%b %Y")).ticks(d3.timeMonth.every(1)));


            let AmazonCloseAxis = d3.axisRight(AmazonCloseScale)
             svg.append("g").attr("class", "amazon close axis").attr("transform","translate(0,0)").call(AmazonCloseAxis)

            let ZMCloseAxis = d3.axisRight(ZMCloseScale)
            svg.append("g").attr("class", "ZM close axis").attr("transform","translate(600,0)").call(ZMCloseAxis)

           

             let SPLineGenerator=d3.line().x(d=>xScale(d["Date"])).y(d=>SPCloseScale(d["Close"])).curve(d3.curveBasis);

             let AmazonLineGenerator=d3.line().x(d=>xScale(d["Date"])).y(d=>AmazonCloseScale(d["Close"])).curve(d3.curveBasis);

             let ZMGenerator=d3.line().x(d=>xScale(d["Date"])).y(d=>ZMCloseScale(d["Close"])).curve(d3.curveBasis);

             
            



            svg.append("path").datum(SPData).attr("class","sp line")
                                          .attr("fill","none")
                                          .attr("stroke","black")
                                          .attr("stroke-width","1px")
                                          .attr("transform", "translate(0,0)")
                                          .attr("d",SPLineGenerator);

            svg.append("path").datum(SPData).attr("class","second sp line")
                                          .attr("fill","none")
                                          .attr("stroke","black")
                                          .attr("stroke-width","1px")
                                          .attr("transform", "translate(600,0)")
                                          .attr("d",SPLineGenerator);
            
            svg.append("path").datum(AmazonData).attr("class","amazon line")
                                          .attr("fill","none")
                                          .attr("stroke","black")
                                          .attr("stroke-width","1px")
                                          .attr("transform", "translate(0,0)")
                                          .attr("d",AmazonLineGenerator);

            svg.append("path").datum(ZMData).attr("class","zoom line")
                                          .attr("fill","none")
                                          .attr("stroke","black")
                                          .attr("stroke-width","1px")
                                          .attr("transform", "translate(600,0)")
                                          .attr("d",ZMGenerator);

            let AmazonmouseArea = svg.append("g").append("rect")
                         .attr("x",0+50)
                         .attr("y",(height-100)/2)
                         .attr("width",550-50)
                         .attr ('height', (height-100)/2)
                         .attr("opacity", 0)

            let AmazonmouseLine = svg.append("g").append("line")
                                 .attr("x1",500)
                                 .attr("x2",0)
                                 .attr("y1",0)
                                 .attr("y2",250)
                                 .attr("stroke","black")
                                 .attr("stroke-width",1)
                                 .style("stroke-dasharray", ("3, 3"))
                                 .attr("opacity",0)

            let AmazonmouseText = svg.append("g").append("text")
                                    .attr("x",0)
                                    .attr("y",0)
                                    .text("")
                                    .attr("opacity",0)
                          
          
          AmazonmouseArea.on("mouseover", function() {
                     AmazonmouseLine.attr("opacity",1);
                     AmazonmouseText.attr("opacity",1);
                    });

                  let  bisect_function_amz = d3.bisector(d => d['Date']);

          AmazonmouseArea.on("mousemove", function() {
                         current_date =  xScale.invert(d3.mouse(this)[0]);
                        let current_index = bisect_function_amz.right(AmazonData, current_date);
                         current_data = AmazonData[current_index];
                         AmazonmouseLine.attr("x1",d3.mouse(this)[0])
                                 .attr("x2",d3.mouse(this)[0])
                                 .attr("y1",height-100)
                                 .attr("y2", d3.mouse(this)[1])
                                

                        AmazonmouseText.text("Amazon Price: " + current_data['Close']).attr("x",d3.event.pageX-89).attr("y",d3.event.pageY);
                     
                    });
          AmazonmouseArea.on("mouseout", function() {
                     AmazonmouseLine.attr("opacity",0);
                     AmazonmouseText.attr("opacity",0);
                    });

             raw_key_date_1='2020-03-23';
             key_date_1=timeparser(raw_key_date_1);
             first_y1_index = bisect_function_amz.left(AmazonData, key_date_1);
             first_y1=AmazonData[first_y1_index]['Close']
             first_y2_index=bisect_function_amz.left(SPData, key_date_1);
             first_y2=SPData[first_y2_index]['Close']

             raw_key_date_2='2020-03-26';
             key_date_2=timeparser(raw_key_date_2);
             second_y1_index = bisect_function_amz.left(AmazonData, key_date_2);
             second_y1=AmazonData[second_y1_index]['Close']
             second_y2_index=bisect_function_amz.left(SPData, key_date_2);
             second_y2=SPData[second_y2_index]['Close']

             raw_key_date_3='2020-04-16';
             key_date_3=timeparser(raw_key_date_3);
             third_y1_index = bisect_function_amz.left(AmazonData, key_date_3);
             third_y1=AmazonData[third_y1_index]['Close']
             third_y2_index=bisect_function_amz.left(SPData, key_date_3);
             third_y2=SPData[third_y2_index]['Close']

             raw_key_date_4='2020-04-20';
             key_date_4=timeparser(raw_key_date_4);
             fourth_y1_index = bisect_function_amz.left(AmazonData, key_date_4);
             fourth_y1=AmazonData[fourth_y1_index]['Close']
             fourth_y2_index=bisect_function_amz.left(SPData, key_date_4);
             fourth_y2=SPData[fourth_y2_index]['Close']


             raw_key_date_5='2020-04-21';
             key_date_5=timeparser(raw_key_date_5);
             fifth_y1_index = bisect_function_amz.left(AmazonData, key_date_5);
             fifth_y1=AmazonData[fifth_y1_index]['Close']
             fifth_y2_index=bisect_function_amz.left(SPData, key_date_5);
             fifth_y2=SPData[fifth_y2_index]['Close']


             raw_key_date_6='2020-04-29';
             key_date_6=timeparser(raw_key_date_6);
             sixth_y1_index = bisect_function_amz.left(AmazonData, key_date_6);
             sixth_y1=AmazonData[sixth_y1_index]['Close']
             sixth_y2_index=bisect_function_amz.left(SPData, key_date_6);
             sixth_y2=SPData[sixth_y2_index]['Close']


             svg.append('line')
                 .attr('x1',xScale(key_date_1))
                 .attr('x2',xScale(key_date_1))
                 .attr('y1',AmazonCloseScale(first_y1))
                 .attr('y2',SPCloseScale(first_y2)-5)
                 .attr('stroke','red')
                 .attr('stroke-width','1')
                 .style("stroke-dasharray", ("3, 3"))

                 svg.append('line')
                 .attr('x1',xScale(key_date_2))
                 .attr('x2',xScale(key_date_2))
                 .attr('y1',AmazonCloseScale(second_y1)+2)
                 .attr('y2',SPCloseScale(second_y2)+2)
                 .attr('stroke','green')
                 .attr('stroke-width','1')
                 .style("stroke-dasharray", ("3, 3"))

                 svg.append('line')
                 .attr('x1',xScale(key_date_3))
                 .attr('x2',xScale(key_date_3))
                 .attr('y1',AmazonCloseScale(third_y1)+2)
                 .attr('y2',SPCloseScale(third_y2))
                 .attr('stroke','green')
                 .attr('stroke-width','1')
                 .style("stroke-dasharray", ("3, 3"))

                 svg.append('line')
                 .attr('x1',xScale(key_date_4))
                 .attr('x2',xScale(key_date_4))
                 .attr('y1',AmazonCloseScale(fourth_y1)+2)
                 .attr('y2',SPCloseScale(fourth_y2)+2)
                 .attr('stroke','red')
                 .attr('stroke-width','1')
                 .style("stroke-dasharray", ("3, 3"))

                 svg.append('line')
                 .attr('x1',xScale(key_date_5))
                 .attr('x2',xScale(key_date_5))
                 .attr('y1',AmazonCloseScale(fifth_y1)-2)
                 .attr('y2',SPCloseScale(fifth_y2)-2)
                 .attr('stroke','green')
                 .attr('stroke-width','1')
                 .style("stroke-dasharray", ("3, 3"))


                 svg.append('line')
                 .attr('x1',xScale(key_date_6))
                 .attr('x2',xScale(key_date_6))
                 .attr('y1',AmazonCloseScale(sixth_y1))
                 .attr('y2',SPCloseScale(sixth_y2)+2)
                 .attr('stroke','green')
                 .attr('stroke-width','1')
                 .style("stroke-dasharray", ("3, 3"))

            let ZoommouseArea = svg.append("g").append("rect")
                         .attr("x",600+50)
                         .attr("y",(height-100)/2)
                         .attr("width",550-50)
                         .attr ('height', (height-100)/2)
                         .attr("opacity", 0)


            let ZoommouseLine = svg.append("g").append("line")
                                 .attr("x1",500)
                                 .attr("x2",0)
                                 .attr("y1",0)
                                 .attr("y2",250)
                                 .attr("stroke","black")
                                 .attr("stroke-width",1)
                                 .style("stroke-dasharray", ("3, 3"))
                                 .attr("opacity",0)

            let ZoommouseText = svg.append("g").append("text")
                                    .attr("x",0)
                                    .attr("y",0)
                                    .text("")
                                    .attr("opacity",0)
                          
          
          ZoommouseArea.on("mouseover", function() {
                     ZoommouseLine.attr("opacity",1);
                     ZoommouseText.attr("opacity",1);
                    });

                  let  bisect_function_zm = d3.bisector(d => d['Date']);

          ZoommouseArea.on("mousemove", function() {
                         current_date =  secondxScale.invert(d3.mouse(this)[0]);
                       
                        let current_index = bisect_function_zm.right(ZMData, current_date);
                        
                         current_data = ZMData[current_index];
                      
                       ZoommouseLine.attr("x1",d3.mouse(this)[0])
                                 .attr("x2",d3.mouse(this)[0])
                                 .attr("y1",height-100)
                               
                                 .attr("y2", d3.mouse(this)[1])
                                
                     
                       ZoommouseText.text("Zoom Price: " + current_data['Close']).attr("x",d3.event.pageX-89).attr("y",d3.event.pageY);
                     
                    });
            ZoommouseArea.on("mouseout", function() {
                    ZoommouseLine.attr("opacity",0);
                    ZoommouseText.attr("opacity",0);
                    });

            
             first_y1_index_2 = bisect_function_amz.left(ZMData, key_date_1);
             first_y1_2=ZMData[first_y1_index_2]['Close']
           

             second_y1_index_2 = bisect_function_amz.left(ZMData, key_date_2);
             second_y1_2=ZMData[second_y1_index_2]['Close']
            
             third_y1_index_2 = bisect_function_amz.left(ZMData, key_date_3);
             third_y1_2=ZMData[third_y1_index_2]['Close']
              

             fourth_y1_index_2 = bisect_function_amz.left(ZMData, key_date_4);
             fourth_y1_2=ZMData[fourth_y1_index_2]['Close']

             fifth_y1_index_2 = bisect_function_amz.left(ZMData, key_date_5);
             fifth_y1_2=ZMData[fifth_y1_index_2]['Close']

             sixth_y1_index_2 = bisect_function_amz.left(ZMData, key_date_6);
             sixth_y1_2=ZMData[sixth_y1_index_2]['Close']
             
             svg.append('line')
                 .attr('x1',secondxScale(key_date_1))
                 .attr('x2',secondxScale(key_date_1))
                 .attr('y1',ZMCloseScale(first_y1_2)+10)
                 .attr('y2',SPCloseScale(first_y2)-5)
                 .attr('stroke','red')
                 .attr('stroke-width','1')
                 .style("stroke-dasharray", ("3, 3"))
          
            
            svg.append('line')
                 .attr('x1',secondxScale(key_date_2))
                 .attr('x2',secondxScale(key_date_2))
                 .attr('y1',ZMCloseScale(second_y1_2))
                 .attr('y2',SPCloseScale(second_y2)+2)
                 .attr('stroke','green')
                 .attr('stroke-width','1')
                 .style("stroke-dasharray", ("3, 3"))

                 svg.append('line')
                 .attr('x1',secondxScale(key_date_3))
                 .attr('x2',secondxScale(key_date_3))
                 .attr('y1',ZMCloseScale(third_y1_2))
                 .attr('y2',SPCloseScale(third_y2))
                 .attr('stroke','green')
                 .attr('stroke-width','1')
                 .style("stroke-dasharray", ("3, 3"))

                 svg.append('line')
                 .attr('x1',secondxScale(key_date_4))
                 .attr('x2',secondxScale(key_date_4))
                 .attr('y1',ZMCloseScale(fourth_y1_2))
                 .attr('y2',SPCloseScale(fourth_y2)+2)
                 .attr('stroke','red')
                 .attr('stroke-width','1')
                 .style("stroke-dasharray", ("3, 3"))

                 svg.append('line')
                 .attr('x1',secondxScale(key_date_5))
                 .attr('x2',secondxScale(key_date_5))
                 .attr('y1',ZMCloseScale(fifth_y1_2))
                 .attr('y2',SPCloseScale(fifth_y2)-2)
                 .attr('stroke','green')
                 .attr('stroke-width','1')
                 .style("stroke-dasharray", ("3, 3"))

                 svg.append('line')
                 .attr('x1',secondxScale(key_date_6))
                 .attr('x2',secondxScale(key_date_6))
                 .attr('y1',ZMCloseScale(sixth_y1_2))
                 .attr('y2',SPCloseScale(sixth_y2)+2)
                 .attr('stroke','green')
                 .attr('stroke-width','1')
                 .style("stroke-dasharray", ("3, 3"))
           

            let SPmouseArea = svg.append("g").append("rect")
                         .attr("x",50)
                         .attr("y",0)
                         .attr("width",550-50)
                         .attr ('height', (height-100)/2)
                         .attr("opacity", 0)

            let SPmouseLine = svg.append("g").append("line")
                                 .attr("x1",500)
                                 .attr("x2",0)
                                 .attr("y1",0)
                                 .attr("y2",250)
                                 .attr("stroke","black")
                                 .attr("stroke-width",1)
                                 .style("stroke-dasharray", ("3, 3"))
                                 .attr("opacity",0)

            let SPmouseText = svg.append("g").append("text")
                                    .attr("x",0)
                                    .attr("y",0)
                                    .text("")
                                    .attr("opacity",0)
                          
          
          SPmouseArea.on("mouseover", function() {
                     SPmouseLine.attr("opacity",1);
                     SPmouseText.attr("opacity",1);
                    });

                  let  bisect_function_sp = d3.bisector(d => d['Date']);

          SPmouseArea.on("mousemove", function() {
                       
                        current_date =  xScale.invert(d3.mouse(this)[0]);
                       
                         current_index = bisect_function_sp.right(SPData, current_date);
                        
                       
          
                        
                         current_data = SPData[current_index];
                       

                         SPmouseLine.attr("x1",d3.mouse(this)[0])
                        .attr("x2",d3.mouse(this)[0])
                                  .attr("y1",height-100)
                                  .attr("y2", d3.mouse(this)[1])
                                  .attr("opacity",1)
                       

                        SPmouseText.text("SP500 Price: " + current_data['Close']).attr("x",d3.event.pageX-89+"px").attr("y", d3.event.pageY+"px").attr("opacity",1);
                     
                    });
          SPmouseArea.on("mouseout", function() {
                     SPmouseLine.attr("opacity",0);
                     SPmouseText.attr("opacity",0);
                    });

            let SecondSPmouseArea = svg.append("g").append("rect")
                         .attr("x",600+50)
                         .attr("y",0)
                         .attr("width",550-50)
                         .attr ('height', (height-100)/2)
                         .attr("opacity", 0)

            let SecondSPmouseLine = svg.append("g").append("line")
                                 .attr("x1",500)
                                 .attr("x2",0)
                                 .attr("y1",0)
                                 .attr("y2",250)
                                 .attr("stroke","black")
                                 .attr("stroke-width",1)
                                 .style("stroke-dasharray", ("3, 3"))
                                 .attr("opacity",0)

            let SecondSPmouseText = svg.append("g").append("text")
                                    .attr("x",0)
                                    .attr("y",0)
                                    .text("")
                                    .attr("opacity",0)
                          
          
          SecondSPmouseArea.on("mouseover", function() {
                     SecondSPmouseLine.attr("opacity",1);
                     SecondSPmouseText.attr("opacity",1);
                    });

                 

          SecondSPmouseArea.on("mousemove", function() {
                       
                        current_date =  secondxScale.invert(d3.mouse(this)[0]);
                      
                         current_index = bisect_function_sp.right(SPData, current_date);
                      
          
                        
                         current_data = SPData[current_index];
                       

                       SecondSPmouseLine.attr("x1",d3.mouse(this)[0])
                        .attr("x2",d3.mouse(this)[0])
                                  .attr("y1",height-100)
                                  .attr("y2", d3.mouse(this)[1])
                                  .attr("opacity",1)
                      

                      SecondSPmouseText.text("SP500 Price: " + current_data['Close']).attr("x",d3.event.pageX-89+"px").attr("y", d3.event.pageY+"px").attr("opacity",1);
                     
                    });
                    SecondSPmouseArea.on("mouseout", function() {
                     SecondSPmouseLine.attr("opacity",0);
                     SecondSPmouseText.attr("opacity",0);
                    });


});
        </script>
   
    </body></html>


    <html><body>
    
          <svg id="second" width="1320" height="300"> 
              <text  id="deltalabel" x=500 y=30>
                  
               </text>
  
               <text  id="uniqlolabel" x=1100 y=30>
                  
               </text>
  
             
  
               <text  id="negativelabel1" x=396 y=15>
                  
               </text>
  
               <text  id="negativelabel2" x=1006 y=15>
                  
               </text>
          </svg>
        
          <script>
                 
  
  Promise.all([d3.csv("DAL.csv"),d3.csv("^GSPC.csv"),d3.csv("FRCOY.csv")]).then(function(files) {
  
            DALData =files[0] 
            SPData = files[1] 
            UNIData = files[2]
  
            let timeparser=d3.timeParse('%Y-%m-%d');


            d3.select("#deltalabel").text("DELTA");
           d3.select("#uniqlolabel").text("UNIQLO");
          d3.select("#negativelabel1").text("NEGATIVE GROWTH");
          d3.select("#negativelabel2").text("NEGATIVE GROWTH");
  
                DALData.forEach(d=>{
                     d['Volume'] = Number(d['Volume']);
                     d['Close'] = Number (d['Close'])
                 
                      d["Date"] = timeparser(d["Date"]);
                 });
  
                 SPData.forEach((d,i)=>{
                     d['Volume'] = Number(d['Volume']);
                     d['Close'] = Number (d['Close'])
                    d["Date"] = timeparser(d["Date"])
                
                 });
  
                 UNIData.forEach((d,i)=>{
                     d['Volume'] = Number(d['Volume']);
                     d['Close'] = Number (d['Close'])
                    d["Date"] = timeparser(d["Date"])
                 
                 });
  
               let svg2 = d3.select("svg#second");
               let width = svg2.attr("width");
               let height = svg2.attr("height");
  
             
  
               let xExtent = d3.extent(UNIData, d => d["Date"]);
            
             let xScale = d3.scaleTime().domain(xExtent).range([50,550]);
             let secondxScale= d3.scaleTime().domain(xExtent).range([650,1150]);
  
            
  
            const DALMinClose=d3.min(DALData, (d) => {return d['Close'];} ); 
            const DALMaxClose=d3.max(DALData, (d) => {return d['Close'];} );
  
               const SPMinClose = d3.min(SPData, (d) => {return d['Close'];});
               const SPMaxClose = d3.max(SPData, (d) => {return d['Close'];});
  
               const UNIMinClose=d3.min(UNIData, (d) => {return d['Close'];} );
               const UNIMaxClose=d3.max(UNIData, (d) => {return d['Close'];} );
  
  
             
              let DALCloseScale=d3.scaleLinear().domain([DALMinClose,DALMaxClose]) .range([height-100,(height-100)/2]);
  
              let UNICloseScale=d3.scaleLinear().domain([UNIMinClose,UNIMaxClose]) .range([height-100,(height-100)/2]);
  
           
             let SPCloseScale = d3.scaleLinear().domain([SPMinClose,SPMaxClose]) .range([(height-100)/2,0]);
  
  
               let xAxis=d3.axisBottom(xScale);
  
               let secondxAxis = d3.axisBottom(secondxScale);
  
  
              svg2.append("g").attr("class", "xAxis").attr("transform", "translate(0,200)")
              .call(xAxis.tickFormat(d3.timeFormat("%b %Y")).ticks(d3.timeMonth.every(1)));
  
              svg2.append("g").attr("class", "second xAxis").attr("transform", "translate(0,200)")
              .call(secondxAxis.tickFormat(d3.timeFormat("%b %Y")).ticks(d3.timeMonth.every(1)));
  
           
  
              let DALCloseAxis = d3.axisRight(DALCloseScale)
               svg2.append("g").attr("class", "DAL close axis").attr("transform","translate(0,0)").call(DALCloseAxis)
  
              let UNICloseAxis = d3.axisRight(UNICloseScale)
              svg2.append("g").attr("class", "UNI close axis").attr("transform","translate(600,0)").call(UNICloseAxis)
  
             
  
              let SPLineGenerator=d3.line().x(d=>xScale(d["Date"])).y(d=>SPCloseScale(d["Close"])).curve(d3.curveBasis);
            
  
               let DALLineGenerator=d3.line().x(d=>xScale(d["Date"])).y(d=>DALCloseScale(d["Close"])).curve(d3.curveBasis);
  
               let UNIGenerator=d3.line().x(d=>xScale(d["Date"])).y(d=>UNICloseScale(d["Close"])).curve(d3.curveBasis);
  
               
              
  
  
  
              svg2.append("path").datum(SPData).attr("class","sp line")
                                            .attr("fill","none")
                                            .attr("stroke","black")
                                            .attr("stroke-width","1px")
                                            .attr("transform", "translate(0,0)")
                                            .attr("d",SPLineGenerator);
  
              svg2.append("path").datum(SPData).attr("class","second sp line")
                                            .attr("fill","none")
                                            .attr("stroke","black")
                                            .attr("stroke-width","1px")
                                            .attr("transform", "translate(600,0)")
                                            .attr("d",SPLineGenerator);
              
              svg2.append("path").datum(DALData).attr("class","delta line")
                                            .attr("fill","none")
                                            .attr("stroke","black")
                                            .attr("stroke-width","1px")
                                            .attr("transform", "translate(0,0)")
                                            .attr("d",DALLineGenerator);
  
              svg2.append("path").datum(UNIData).attr("class","UNIQLO line")
                                            .attr("fill","none")
                                            .attr("stroke","black")
                                            .attr("stroke-width","1px")
                                            .attr("transform", "translate(600,0)")
                                            .attr("d",UNIGenerator);
  
             
  
              let DALmouseArea = svg2.append("g").append("rect")
                           .attr("x",0+50)
                           .attr("y",(height-150)/2)
                           .attr("width",550-50)
                           .attr ('height', (height-50)/2)
                           .attr("opacity", 0)
  
                           
  
              let DALmouseLine = svg2.append("g").append("line")
                                   .attr("x1",500)
                                   .attr("x2",0)
                                   .attr("y1",0)
                                   .attr("y2",250)
                                   .attr("stroke","black")
                                   .attr("stroke-width",1)
                                   .style("stroke-dasharray", ("3, 3"))
                                   .attr("opacity",0)
  
              let DALmouseText = svg2.append("g").append("text")
                                      .attr("x",0)
                                      .attr("y",0)
                                      .text("")
                                      .attr("opacity",0)
                            
            
            DALmouseArea.on("mouseover", function() {
                       DALmouseLine.attr("opacity",1);
                       DALmouseText.attr("opacity",1);
                      });
  
                    let  bisect_function_dal = d3.bisector(d => d['Date']);
  
            DALmouseArea.on("mousemove", function() {
                           current_date =  xScale.invert(d3.mouse(this)[0]);
                        
                          let current_index = bisect_function_dal.right(DALData, current_date);
                          
                           current_data = DALData[current_index];
                      
                           DALmouseLine.attr("x1",d3.mouse(this)[0])
                                   .attr("x2",d3.mouse(this)[0])
                                   .attr("y1",height-100)
                                
                                   .attr("y2", d3.mouse(this)[1])
                                  
                       
  
                          DALmouseText.text("Delta Price: " + current_data['Close']).attr("x",xScale(current_date)).attr("y",DALCloseScale(current_data['Close'])-10);
                       

                       
                      });
            DALmouseArea.on("mouseout", function() {
                       DALmouseLine.attr("opacity",0);
                       DALmouseText.attr("opacity",0);
                      });
  
               raw_key_date_1='2020-03-23';
               key_date_1=timeparser(raw_key_date_1);
               first_y1_index = bisect_function_dal.left(DALData, key_date_1);
               first_y1=DALData[first_y1_index]['Close']
               first_y2_index=bisect_function_dal.left(SPData, key_date_1);
               first_y2=SPData[first_y2_index]['Close']
  
               raw_key_date_2='2020-03-26';
               key_date_2=timeparser(raw_key_date_2);
               second_y1_index = bisect_function_dal.left(DALData, key_date_2);
               second_y1=DALData[second_y1_index]['Close']
               second_y2_index=bisect_function_dal.left(SPData, key_date_2);
               second_y2=SPData[second_y2_index]['Close']
  
               raw_key_date_3='2020-04-16';
               key_date_3=timeparser(raw_key_date_3);
               third_y1_index = bisect_function_dal.left(DALData, key_date_3);
               third_y1=DALData[third_y1_index]['Close']
               third_y2_index=bisect_function_dal.left(SPData, key_date_3);
               third_y2=SPData[third_y2_index]['Close']
  
               raw_key_date_4='2020-04-20';
               key_date_4=timeparser(raw_key_date_4);
               fourth_y1_index = bisect_function_dal.left(DALData, key_date_4);
               fourth_y1=DALData[fourth_y1_index]['Close']
               fourth_y2_index=bisect_function_dal.left(SPData, key_date_4);
               fourth_y2=SPData[fourth_y2_index]['Close']
  
  
               raw_key_date_5='2020-04-21';
               key_date_5=timeparser(raw_key_date_5);
               fifth_y1_index = bisect_function_dal.left(DALData, key_date_5);
               fifth_y1=DALData[fifth_y1_index]['Close']
               fifth_y2_index=bisect_function_dal.left(SPData, key_date_5);
               fifth_y2=SPData[fifth_y2_index]['Close']
  
  
               raw_key_date_6='2020-04-29';
               key_date_6=timeparser(raw_key_date_6);
               sixth_y1_index = bisect_function_dal.left(DALData, key_date_6);
               sixth_y1=DALData[sixth_y1_index]['Close']
               sixth_y2_index=bisect_function_dal.left(SPData, key_date_6);
               sixth_y2=SPData[sixth_y2_index]['Close']
  
  
               svg2.append('line')
                   .attr('x1',xScale(key_date_1))
                   .attr('x2',xScale(key_date_1))
                   .attr('y1',DALCloseScale(first_y1)-5)
                   .attr('y2',SPCloseScale(first_y2)-5)
                   .attr('stroke','red')
                   .attr('stroke-width','1')
                   .style("stroke-dasharray", ("3, 3"))
  
                   svg2.append('line')
                   .attr('x1',xScale(key_date_2))
                   .attr('x2',xScale(key_date_2))
                   .attr('y1',DALCloseScale(second_y1)+2)
                   .attr('y2',SPCloseScale(second_y2)+4)
                   .attr('stroke','green')
                   .attr('stroke-width','1')
                   .style("stroke-dasharray", ("3, 3"))
  
                   svg2.append('line')
                   .attr('x1',xScale(key_date_3))
                   .attr('x2',xScale(key_date_3))
                   .attr('y1',DALCloseScale(third_y1))
                   .attr('y2',SPCloseScale(third_y2))
                   .attr('stroke','green')
                   .attr('stroke-width','1')
                   .style("stroke-dasharray", ("3, 3"))
  
                   svg2.append('line')
                   .attr('x1',xScale(key_date_4))
                   .attr('x2',xScale(key_date_4))
                   .attr('y1',DALCloseScale(fourth_y1))
                   .attr('y2',SPCloseScale(fourth_y2)+2)
                   .attr('stroke','red')
                   .attr('stroke-width','1')
                   .style("stroke-dasharray", ("3, 3"))
  
                   svg2.append('line')
                   .attr('x1',xScale(key_date_5))
                   .attr('x2',xScale(key_date_5))
                   .attr('y1',DALCloseScale(fifth_y1))
                   .attr('y2',SPCloseScale(fifth_y2)-2)
                   .attr('stroke','green')
                   .attr('stroke-width','1')
                   .style("stroke-dasharray", ("3, 3"))
  
  
                   svg2.append('line')
                   .attr('x1',xScale(key_date_6))
                   .attr('x2',xScale(key_date_6))
                   .attr('y1',DALCloseScale(sixth_y1)+2)
                   .attr('y2',SPCloseScale(sixth_y2)+2)
                   .attr('stroke','green')
                   .attr('stroke-width','1')
                   .style("stroke-dasharray", ("3, 3"))
  
              let UNImouseArea = svg2.append("g").append("rect")
                           .attr("x",600+50)
                           .attr("y",(height-100)/2)
                           .attr("width",550-50)
                           .attr ('height', (height-100)/2)
                           .attr("opacity", 0)
  
                         
  
              let UNImouseLine = svg2.append("g").append("line")
                                   .attr("x1",500)
                                   .attr("x2",0)
                                   .attr("y1",0)
                                   .attr("y2",250)
                                   .attr("stroke","black")
                                   .attr("stroke-width",1)
                                   .style("stroke-dasharray", ("3, 3"))
                                   .attr("opacity",0)
  
              let UNImouseText = svg2.append("g").append("text")
                                      .attr("x",0)
                                      .attr("y",0)
                                      .text("")
                                      .attr("opacity",0)
                            
            
            UNImouseArea.on("mouseover", function() {
                       UNImouseLine.attr("opacity",1);
                       UNImouseText.attr("opacity",1);
                      });
  
                    let  bisect_function_uni = d3.bisector(d => d['Date']);
  
            UNImouseArea.on("mousemove", function() {
                           current_date =  secondxScale.invert(d3.mouse(this)[0]);
                        
                          let current_index = bisect_function_uni.right(UNIData, current_date);
                          
                           current_data = UNIData[current_index];
                        
                         UNImouseLine.attr("x1",d3.mouse(this)[0])
                                   .attr("x2",d3.mouse(this)[0])
                                   .attr("y1",height-100)
                                
                                   .attr("y2", d3.mouse(this)[1])
                                  
                     
  
                         UNImouseText.text("UNIQLO Price: " + current_data['Close']).attr("x",secondxScale(current_date)).attr("y",30+UNICloseScale(current_data['Close']));
                       
                      });
              UNImouseArea.on("mouseout", function() {
                      UNImouseLine.attr("opacity",0);
                      UNImouseText.attr("opacity",0);
                      });
  
              
               first_y1_index_2 = bisect_function_uni.left(UNIData, key_date_1);
               first_y1_2=UNIData[first_y1_index_2]['Close']
             
  
               second_y1_index_2 = bisect_function_uni.left(UNIData, key_date_2);
               second_y1_2=UNIData[second_y1_index_2]['Close']
              
               third_y1_index_2 = bisect_function_uni.left(UNIData, key_date_3);
               third_y1_2=UNIData[third_y1_index_2]['Close']
                
  
               fourth_y1_index_2 = bisect_function_uni.left(UNIData, key_date_4);
               fourth_y1_2=UNIData[fourth_y1_index_2]['Close']
  
               fifth_y1_index_2 = bisect_function_uni.left(UNIData, key_date_5);
               fifth_y1_2=UNIData[fifth_y1_index_2]['Close']
  
               sixth_y1_index_2 = bisect_function_uni.left(UNIData, key_date_6);
               sixth_y1_2=UNIData[sixth_y1_index_2]['Close']
              
               svg2.append('line')
                   .attr('x1',secondxScale(key_date_1))
                   .attr('x2',secondxScale(key_date_1))
                   .attr('y1',UNICloseScale(first_y1_2)-5)
                   .attr('y2',SPCloseScale(first_y2)-5)
                   .attr('stroke','red')
                   .attr('stroke-width','1')
                   .style("stroke-dasharray", ("3, 3"))
            
              
              svg2.append('line')
                   .attr('x1',secondxScale(key_date_2))
                   .attr('x2',secondxScale(key_date_2))
                   .attr('y1',UNICloseScale(second_y1_2))
                   .attr('y2',SPCloseScale(second_y2)+2)
                   .attr('stroke','green')
                   .attr('stroke-width','1')
                   .style("stroke-dasharray", ("3, 3"))
  
                   svg2.append('line')
                   .attr('x1',secondxScale(key_date_3))
                   .attr('x2',secondxScale(key_date_3))
                   .attr('y1',UNICloseScale(third_y1_2))
                   .attr('y2',SPCloseScale(third_y2))
                   .attr('stroke','green')
                   .attr('stroke-width','1')
                   .style("stroke-dasharray", ("3, 3"))
  
                   svg2.append('line')
                   .attr('x1',secondxScale(key_date_4))
                   .attr('x2',secondxScale(key_date_4))
                   .attr('y1',UNICloseScale(fourth_y1_2)+2)
                   .attr('y2',SPCloseScale(fourth_y2)+2)
                   .attr('stroke','red')
                   .attr('stroke-width','1')
                   .style("stroke-dasharray", ("3, 3"))
  
                   svg2.append('line')
                   .attr('x1',secondxScale(key_date_5))
                   .attr('x2',secondxScale(key_date_5))
                   .attr('y1',UNICloseScale(fifth_y1_2)-2)
                   .attr('y2',SPCloseScale(fifth_y2)-2)
                   .attr('stroke','green')
                   .attr('stroke-width','1')
                   .style("stroke-dasharray", ("3, 3"))
  
                   svg2.append('line')
                   .attr('x1',secondxScale(key_date_6))
                   .attr('x2',secondxScale(key_date_6))
                   .attr('y1',UNICloseScale(sixth_y1_2))
                   .attr('y2',SPCloseScale(sixth_y2)+2)
                   .attr('stroke','green')
                   .attr('stroke-width','1')
                   .style("stroke-dasharray", ("3, 3"))
             
  
              let SPmouseArea = svg2.append("g").append("rect")
                           .attr("x",0+50)
                           .attr("y",0)
                           .attr("width",550-50)
                           .attr ('height', (height-100)/2)
                           .attr("opacity", 0)
  
              let SPmouseLine = svg2.append("g").append("line")
                                   .attr("x1",500)
                                   .attr("x2",0)
                                   .attr("y1",0)
                                   .attr("y2",250)
                                   .attr("stroke","black")
                                   .attr("stroke-width",1)
                                   .style("stroke-dasharray", ("3, 3"))
                                   .attr("opacity",0)
  
              let SPmouseText = svg2.append("g").append("text")
                                      .attr("x",0)
                                      .attr("y",0)
                                      .text("")
                                      .attr("opacity",0)
                            
            
            SPmouseArea.on("mouseover", function() {
                       SPmouseLine.attr("opacity",1);
                       SPmouseText.attr("opacity",1);
                      });
  
                    let  bisect_function_sp = d3.bisector(d => d['Date']);
  
            SPmouseArea.on("mousemove", function() {
                       
                          current_date =  xScale.invert(d3.mouse(this)[0]);
                         
                           current_index = bisect_function_sp.right(SPData, current_date);
                       
                         
            
                           current_data = SPData[current_index];
                         
  
                           SPmouseLine.attr("x1",d3.mouse(this)[0])
                          .attr("x2",d3.mouse(this)[0])
                                    .attr("y1",height-100)
                                    .attr("y2", d3.mouse(this)[1])
                                    .attr("opacity",1)
                       
  
                          SPmouseText.text("SP500 Price: " + current_data['Close']).attr("x",xScale(current_date)).attr("y", 30+SPCloseScale(current_data['Close'])).attr("opacity",1);
                       
                      });
            SPmouseArea.on("mouseout", function() {
                       SPmouseLine.attr("opacity",0);
                       SPmouseText.attr("opacity",0);
                      });
  
              let SecondSPmouseArea = svg2.append("g").append("rect")
                           .attr("x",600+50)
                           .attr("y",0)
                           .attr("width",550-50)
                           .attr ('height', (height-100)/2)
                           .attr("opacity", 0)
  
              let SecondSPmouseLine = svg2.append("g").append("line")
                                   .attr("x1",500)
                                   .attr("x2",0)
                                   .attr("y1",0)
                                   .attr("y2",250)
                                   .attr("stroke","black")
                                   .attr("stroke-width",1)
                                   .style("stroke-dasharray", ("3, 3"))
                                   .attr("opacity",0)
  
              let SecondSPmouseText = svg2.append("g").append("text")
                                      .attr("x",0)
                                      .attr("y",0)
                                      .text("")
                                      .attr("opacity",0)
                            
            
            SecondSPmouseArea.on("mouseover", function() {
                       SecondSPmouseLine.attr("opacity",1);
                       SecondSPmouseText.attr("opacity",1);
                      });
  
                   
  
            SecondSPmouseArea.on("mousemove", function() {
                         
                          current_date =  secondxScale.invert(d3.mouse(this)[0]);
                        
                           current_index = bisect_function_sp.right(SPData, current_date);
                         
                         
            
                        
                           current_data = SPData[current_index];
                        
  
                         SecondSPmouseLine.attr("x1",d3.mouse(this)[0])
                          .attr("x2",d3.mouse(this)[0])
                                    .attr("y1",height-100)
                                    .attr("y2", d3.mouse(this)[1])
                                    .attr("opacity",1)
                        
  
                        SecondSPmouseText.text("SP500 Price: " + current_data['Close']).attr("x",secondxScale(current_date)).attr("y", 30+SPCloseScale(current_data['Close'])).attr("opacity",1);
                       
                      });
                      SecondSPmouseArea.on("mouseout", function() {
                       SecondSPmouseLine.attr("opacity",0);
                       SecondSPmouseText.attr("opacity",0);
                      });
  
  
  });
          </script>
     
      </body></html>

      <html><body>
        <b> Representative Stock Price versus Trading Volume </b>
              <svg id="third" width="1320" height="300"> 
                  <text  id="amazonlabel2" x=500 y=42>
                      
                   </text>
      
                   <text  id="zoomlabel2" x=1100 y=42>
                      
                   </text>
      
                 
      
              </svg>
            
              <script>
      Promise.all([d3.csv("AMZN.csv"),d3.csv("^GSPC.csv"),d3.csv("ZM.csv")]).then(function(files) {
        AmazonData3 =files[0] 
          SPData3 = files[1] 
          ZMData3 = files[2]

          let timeparser3=d3.timeParse('%Y-%m-%d');

          d3.select("#amazonlabel2").text("AMAZON");
          d3.select("#zoomlabel2").text("ZOOM");
         

              AmazonData3.forEach(d=>{
                   d['Volume'] = Number(d['Volume']);
                   d['Close'] = Number (d['Close'])
              
                    d["Date"] = timeparser3(d["Date"]);
               });

               SPData3.forEach((d,i)=>{
                   d['Volume'] = Number(d['Volume']);
                   d['Close'] = Number (d['Close'])
                  d["Date"] = timeparser3(d["Date"])
               
               });

               ZMData3.forEach((d,i)=>{
                   d['Volume'] = Number(d['Volume']);
                   d['Close'] = Number (d['Close'])
                  d["Date"] = timeparser3(d["Date"])
               
               });

             let svg3 = d3.select("svg#third");
             let width3 = svg3.attr("width");
             let height3 = svg3.attr("height");

            

             let xExtent3 = d3.extent(AmazonData3, d => d["Date"]);
          
           let xScale3 = d3.scaleTime().domain(xExtent3).range([55,550]);
           let secondxScale3= d3.scaleTime().domain(xExtent3).range([650,1150]);

           

          const AmazonMinClose3=d3.min(AmazonData3, (d) => {return d['Close'];} ); 
          const AmazonMaxClose3=d3.max(AmazonData3, (d) => {return d['Close'];} );

          const AmazonMinVol3=d3.min(AmazonData3, (d) => {return d['Volume'];});
          const AmazonMaxVol3=d3.max(AmazonData3, (d) => {return d['Volume'];});

             const ZMMinClose3=d3.min(ZMData3, (d) => {return d['Close'];} );
             const ZMMaxClose3=d3.max(ZMData3, (d) => {return d['Close'];} );

             const ZMMinVol3=d3.min(ZMData3, (d) => {return d['Volume'];} );
             const ZMMaxVol3=d3.max(ZMData3, (d) => {return d['Volume'];} );


           
            let AmazonCloseScale3=d3.scaleLinear().domain([AmazonMinClose3,AmazonMaxClose3]) .range([(height3-100)/2,0]);

            let ZMCloseScale3=d3.scaleLinear().domain([ZMMinClose3,ZMMaxClose3]) .range([(height3-100)/2,0]);

        
           let  AmazonVolScale3= d3.scaleLinear().domain([AmazonMinVol3,AmazonMaxVol3]).range([height3-20,(height3-100)/2]);
           let  ZMVolScale3= d3.scaleLinear().domain([ZMMinVol3,ZMMaxVol3]).range([height3-20,(height3-100)/2]);

             let xAxis3=d3.axisBottom(xScale3);

             let secondxAxis3 = d3.axisBottom(secondxScale3);


            svg3.append("g").attr("class", "xAxis3").attr("transform", "translate(0,280)")
            .call(xAxis3.tickFormat(d3.timeFormat("%b %Y")).ticks(d3.timeMonth.every(1)));

            svg3.append("g").attr("class", "second xAxis3").attr("transform", "translate(0,280)")
            .call(secondxAxis3.tickFormat(d3.timeFormat("%b %Y")).ticks(d3.timeMonth.every(1)));

            

            let AmazonVolAxis3 = d3.axisRight(AmazonVolScale3)
             svg3.append("g").attr("class", "amazon vol axis3").attr("transform","translate(0,0)").call(AmazonVolAxis3)

             let ZMVolAxis3 = d3.axisRight(ZMVolScale3)
             svg3.append("g").attr("class", "zoom vol axis3").attr("transform","translate(600,0)").call(ZMVolAxis3)
           

             AmazonData3.forEach((d,i)=>{
                  let histogram = svg3.append('g').append('rect')
                           .attr("x",xScale3(d['Date']))
                           .attr("y",AmazonVolScale3(d["Volume"]))
                           .attr("width","4")
                           .attr ('height', (280-AmazonVolScale3(d['Volume'])))
                        
                           .attr("fill", function(){
                             if (i==0){
                               return "red"
                             }
                             else if (AmazonData3[i]['Close'] < AmazonData3[i-1]['Close']){
                             
                              return d3.interpolateRgb("red","#fff")(1-(Math.abs(AmazonData3[i]['Close'] - AmazonData3[i-1]['Close'])/AmazonData3[i-1]['Close'])*19)
                             }
                             else{
                              
                              return d3.interpolateRgb("green","#fff")(1-(Math.abs(AmazonData3[i]['Close'] - AmazonData3[i-1]['Close'])/AmazonData3[i-1]['Close'])*19)
                             }
                           })
                           .attr("opacity", 1)
                           .attr("transform","translate(0,0)")});

                           ZMData3.forEach((d,i)=>{
                            
                             {
                            
                  let histogram2 = svg3.append('g').append('rect')
                           .attr("x",secondxScale3(d['Date']))
                           .attr("y",ZMVolScale3(d["Volume"]))
                        
                           .attr("width","4")
                           .attr ('height', 280-ZMVolScale3(d["Volume"]))
                         
                           .attr("fill", function(){
                             if (i==0){
                               return "red"
                             }
                             else if (ZMData3[i]['Close'] < ZMData3[i-1]['Close']){
                             
                              return d3.interpolateRgb("red","#fff")(1-(Math.abs(ZMData3[i]['Close'] - ZMData3[i-1]['Close'])/ZMData3[i-1]['Close'])*10)
                             }
                             else{
                             
                              return d3.interpolateRgb("green","#fff")(1-(Math.abs(ZMData3[i]['Close'] - ZMData3[i-1]['Close'])/ZMData3[i-1]['Close'])*10)
                             }
                           })
                           .attr("opacity", 1)
                           .attr("transform","translate(0,0)")}});
  

         

              let AmazonLineGenerator3=d3.line().x(d=>xScale3(d["Date"])).y(d=>AmazonCloseScale3(d["Close"])).curve(d3.curveBasis);

              let ZMGenerator3=d3.line().x(d=>secondxScale3(d["Date"])).y(d=>ZMCloseScale3(d["Close"])).curve(d3.curveBasis);

             
            



    
            
            svg3.append("path").datum(AmazonData3).attr("class","amazon line3")
                                          .attr("fill","none")
                                          .attr("stroke",d3.interpolateRgb("grey","#fff")(0.1))
                                          .attr("stroke-width","1px")
                                          .attr("transform", "translate(0,0)")
                                          .attr("d",AmazonLineGenerator3);

            svg3.append("path").datum(ZMData3).attr("class","zoom line3")
                                          .attr("fill","none")
                                          .attr("stroke",d3.interpolateRgb("grey","#fff")(0.1))
                                          .attr("stroke-width","1px")
                                          .attr("transform", "translate(0,0)")
                                          .attr("d",ZMGenerator3);
       });
              </script>
         
          </body></html>
          <html><body>
             
                  <svg id="fourth" width="1320" height="300"> 
                      <text  id="deltalabel2" x=500 y=30>
                          
                       </text>
          
                       <text  id="uniqlolabel2" x=1100 y=30>
                          
                       </text>
                  </svg>
                 
                  <script>
          Promise.all([d3.csv("DAL.csv"),d3.csv("^GSPC.csv"),d3.csv("FRCOY.csv")]).then(function(files) {
            DalData4 =files[0] 
              SPData4 = files[1] 
              UniData4 = files[2]
    
              let timeparser4=d3.timeParse('%Y-%m-%d');

              d3.select("#deltalabel2").text("DELTA");
           d3.select("#uniqlolabel2").text("UNIQLO");
    
              DalData4.forEach(d=>{
                       d['Volume'] = Number(d['Volume']);
                       d['Close'] = Number (d['Close'])
                        d["Date"] = timeparser4(d["Date"]);
                   });
    
                   SPData4.forEach((d,i)=>{
                       d['Volume'] = Number(d['Volume']);
                       d['Close'] = Number (d['Close'])
                      d["Date"] = timeparser4(d["Date"])
                   });
    
                   UniData4.forEach((d,i)=>{
                       d['Volume'] = Number(d['Volume']);
                       d['Close'] = Number (d['Close'])
                      d["Date"] = timeparser4(d["Date"])
                   });
    
                 let svg4= d3.select("svg#fourth");
                 let width4 = svg4.attr("width");
                 let height4 = svg4.attr("height");
    
              
    
                 let xExtent4 = d3.extent(DalData4, d => d["Date"]);
             
               let xScale4 = d3.scaleTime().domain(xExtent4).range([55,550]);
               let secondxScale4= d3.scaleTime().domain(xExtent4).range([650,1150]);
    
              
    
              const DalMinClose4=d3.min(DalData4, (d) => {return d['Close'];} ); 
              const DalMaxClose4=d3.max(DalData4, (d) => {return d['Close'];} );
    
              const DalMinVol4=d3.min(DalData4, (d) => {return d['Volume'];});
              const DalMaxVol4=d3.max(DalData4, (d) => {return d['Volume'];});
    
                 const UniMinClose4=d3.min(UniData4, (d) => {return d['Close'];} );
                 const UniMaxClose4=d3.max(UniData4, (d) => {return d['Close'];} );
    
                 const UniMinVol4=d3.min(UniData4, (d) => {return d['Volume'];} );
                 const UniMaxVol4=d3.max(UniData4, (d) => {return d['Volume'];} );
    
    
              
                let DalCloseScale4=d3.scaleLinear().domain([DalMinClose4,DalMaxClose4]) .range([(height4-100)/2,0]);
    
                let UniCloseScale4=d3.scaleLinear().domain([UniMinClose4,UniMaxClose4]) .range([(height4-100)/2,0]);
    
              
               let  DalVolScale4= d3.scaleLinear().domain([DalMinVol4,DalMaxVol4]).range([height4-20,(height4-100)/2]);
               let  UniVolScale4= d3.scaleLinear().domain([UniMinVol4,UniMaxVol4]).range([height4-20,(height4-100)/2]);
    
                 let xAxis4=d3.axisBottom(xScale4);
    
                 let secondxAxis4 = d3.axisBottom(secondxScale4);
    
    
                svg4.append("g").attr("class", "xAxis4").attr("transform", "translate(0,280)")
                .call(xAxis4.tickFormat(d3.timeFormat("%b %Y")).ticks(d3.timeMonth.every(1)));
    
                svg4.append("g").attr("class", "second xAxis4").attr("transform", "translate(0,280)")
                .call(secondxAxis4.tickFormat(d3.timeFormat("%b %Y")).ticks(d3.timeMonth.every(1)));
    
               
    
                let DalVolAxis4 = d3.axisRight(DalVolScale4)
                 svg4.append("g").attr("class", "amazon vol axis4").attr("transform","translate(0,0)").call(DalVolAxis4)
    
                 let UniVolAxis4 = d3.axisRight(UniVolScale4)
                 svg4.append("g").attr("class", "zoom vol axis4").attr("transform","translate(600,0)").call(UniVolAxis4)
               
    
                DalData4.forEach((d,i)=>{
                      let histogram = svg4.append('g').append('rect')
                               .attr("x",xScale4(d['Date']))
                               .attr("y",DalVolScale4(d["Volume"]))
                               .attr("width","4")
                               .attr ('height', (280-DalVolScale4(d['Volume'])))
                            
                               .attr("fill", function(){
                                 if (i==0){
                                   return "red"
                                 }
                                 else if (DalData4[i]['Close'] < DalData4[i-1]['Close']){
                                
                                  return d3.interpolateRgb("red","#fff")(1-(Math.abs(DalData4[i]['Close'] - DalData4[i-1]['Close'])/DalData4[i-1]['Close'])*9)
                                 }
                                 else{
                                  
                                  return d3.interpolateRgb("green","#fff")(1-(Math.abs(DalData4[i]['Close'] - DalData4[i-1]['Close'])/DalData4[i-1]['Close'])*9)
                                 }
                               })
                               .attr("opacity", 1)
                               .attr("transform","translate(0,0)")});
    
                               UniData4.forEach((d,i)=>{
                                
                                 {
                              
                      let histogram2 = svg4.append('g').append('rect')
                               .attr("x",secondxScale4(d['Date']))
                               .attr("y",UniVolScale4(d["Volume"]))
                          
                               .attr("width","4")
                               .attr ('height', 280-UniVolScale4(d["Volume"]))
                            
                               .attr("fill", function(){
                                 if (i==0){
                                   return "red"
                                 }
                                 else if (UniData4[i]['Close'] < UniData4[i-1]['Close']){
                                
                                  return d3.interpolateRgb("red","#fff")(1-(Math.abs(UniData4[i]['Close'] - UniData4[i-1]['Close'])/UniData4[i-1]['Close'])*25)
                                 }
                                 else{
                                 
                                  return d3.interpolateRgb("green","#fff")(1-(Math.abs(UniData4[i]['Close'] - UniData4[i-1]['Close'])/UniData4[i-1]['Close'])*25)
                                 }
                               })
                               .attr("opacity", 1)
                               .attr("transform","translate(0,0)")}});
      
    
               
    
                  let DalLineGenerator4=d3.line().x(d=>xScale4(d["Date"])).y(d=>DalCloseScale4(d["Close"])).curve(d3.curveBasis);
    
                  let UniGenerator4=d3.line().x(d=>secondxScale4(d["Date"])).y(d=>UniCloseScale4(d["Close"])).curve(d3.curveBasis);
    
                 
                
    
    
    
        
                
                svg4.append("path").datum(DalData4).attr("class","dal line4")
                                              .attr("fill","none")
                                              .attr("stroke",d3.interpolateRgb("grey","#fff")(0.1))
                                              .attr("stroke-width","1px")
                                              .attr("transform", "translate(0,0)")
                                              .attr("d",DalLineGenerator4);
    
                svg4.append("path").datum(UniData4).attr("class","uni line4")
                                              .attr("fill","none")
                                              .attr("stroke",d3.interpolateRgb("grey","#fff")(0.1))
                                              .attr("stroke-width","1px")
                                              .attr("transform", "translate(0,0)")
                                              .attr("d",UniGenerator4);
           });
                  </script>
             
              </body></html>